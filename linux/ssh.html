

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3. SSH &mdash; Cloudmesh Tools Primer 0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Cloudmesh Tools Primer 0.1 documentation" href="../index.html"/>
        <link rel="up" title="Linux" href="index.html"/>
        <link rel="next" title="6. Management" href="../management/index.html"/>
        <link rel="prev" title="2. Make" href="make.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Cloudmesh Tools Primer
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../class/index.html">1. Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cloudmesh/index.html">2. Cloudmesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devops/index.html">3. DevOps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc/index.html">4. Docuumentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iaas/index.html">5. IaaS</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Linux</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="bash.html">1. bash</a></li>
<li class="toctree-l2"><a class="reference internal" href="make.html">2. Make</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3. SSH</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#adding-ather-users-keys">3.1. adding ather users keys</a></li>
<li class="toctree-l3"><a class="reference internal" href="#security-groups">3.2. security groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="#naming-of-vms">3.3. naming of vms*</a></li>
<li class="toctree-l3"><a class="reference internal" href="#naming-on-key-on-the-cloud">3.4. naming on key on the cloud</a></li>
<li class="toctree-l3"><a class="reference internal" href="#accessing-root-on-chameleon-images">3.5. accessing root on chameleon images</a></li>
<li class="toctree-l3"><a class="reference internal" href="#unsetting-os-variabples">3.6. unsetting OS variabples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#keys-on-multiple-machines">3.7. keys on multiple machines</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tunnel">3.8. tunnel</a></li>
<li class="toctree-l3"><a class="reference internal" href="#connecting-between-vms">3.9. connecting between vms</a></li>
<li class="toctree-l3"><a class="reference internal" href="#conclusion">3.10. Conclusion</a></li>
<li class="toctree-l3"><a class="reference internal" href="#but-my-vm-is-active-i-can-not-login">3.11. But my vm is active, I can not login</a></li>
<li class="toctree-l3"><a class="reference internal" href="#denial-of-service-attack-to-your-own-machine">3.12. Denial of service attack to your own machine</a></li>
<li class="toctree-l3"><a class="reference internal" href="#focussing-to-get-a-vm-to-run-thats-obviously-dead">3.13. Focussing to get a vm to run thats obviously dead</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../management/index.html">6. Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/index.html">7. Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../refcards/index.html">8. Refcards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../windows/index.html">9. Windows</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Cloudmesh Tools Primer</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Linux</a> &raquo;</li>
      
    <li>3. SSH</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/linux/ssh.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ssh">
<h1>3. SSH<a class="headerlink" href="#ssh" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference external" href="http://support.suso.com/supki/SSH_Tutorial_for_Linux">http://support.suso.com/supki/SSH_Tutorial_for_Linux</a></li>
<li></li>
</ul>
<p><a class="reference external" href="https://www.digitalocean.com/community/tutorials/how-to-use-ssh-to-connect-to-a-remote-server-in-ubuntu">https://www.digitalocean.com/community/tutorials/how-to-use-ssh-to-connect-to-a-remote-server-in-ubuntu</a>
* <a class="reference external" href="http://www.openbsd.org/papers/auug2002-ssh.pdf">http://www.openbsd.org/papers/auug2002-ssh.pdf</a></p>
<div class="section" id="adding-ather-users-keys">
<h2>3.1. adding ather users keys<a class="headerlink" href="#adding-ather-users-keys" title="Permalink to this headline">¶</a></h2>
<p>put all keys into the authorized_keys file and distribute them on all vms by placing them at ~/.ssh/authorized_keys</p>
<p>WARNING WARNING: before you do this you must make sure that all other keys such as the once created on the vm into the user account or the cc account are also copied into that file. If you just replace the file you may lose access if you forgot to include the appropriate keys, you may not recover form this if you overwrote the wrong keys.</p>
</div>
<div class="section" id="security-groups">
<h2>3.2. security groups<a class="headerlink" href="#security-groups" title="Permalink to this headline">¶</a></h2>
<p>we have seen many students deleting and modifying the default security group, thus we recommend each project sets up a clearly distingishable security group</p>
<p>problem is I am not entirely sure what you want and need to do as this is for sure project dependent. Here an attemt on an FAQ</p>
<p>in the following i use &lt;protalname&gt; as portalname of futuresystems.</p>
<p>security groups**: as projects on kilo and chameleon are shared it is
best to create your own security group under the na
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-</p>
<blockquote>
<div>&lt;portalname&gt;-default</div></blockquote>
<p>and add your rules to that</p>
</div>
<div class="section" id="naming-of-vms">
<h2>3.3. naming of vms*<a class="headerlink" href="#naming-of-vms" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>all vms should have your &lt;portalname&gt; in the name. This will allow you to identify the vms you work with easily</div></blockquote>
</div>
<div class="section" id="naming-on-key-on-the-cloud">
<h2>3.4. naming on key on the cloud<a class="headerlink" href="#naming-on-key-on-the-cloud" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>it is best to name the key on the cloud with your &lt;portalname&gt; in order not to confuse that with others its also good practice to optionally put  -key behind it, SO your key name would be &lt;portalname&gt;-key</div></blockquote>
</div>
<div class="section" id="accessing-root-on-chameleon-images">
<h2>3.5. accessing root on chameleon images<a class="headerlink" href="#accessing-root-on-chameleon-images" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>as documented in the chameleon documentation of their openstack cloud the root user on chameleon images is cc and not ubuntu</div></blockquote>
</div>
<div class="section" id="unsetting-os-variabples">
<h2>3.6. unsetting OS variabples<a class="headerlink" href="#unsetting-os-variabples" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>if you used or sourced openrc.sh files from kilo and switch to chameleon, you natuarally need to unset them. Best is to make sure your do not have tham in bashrc or bash profile and double check with env that no variable starts with <a href="#id1"><span class="problematic" id="id2">OS_</span></a>. If so you need to unset and best start a new terminal, doublecheck</div></blockquote>
</div>
<div class="section" id="keys-on-multiple-machines">
<h2>3.7. keys on multiple machines<a class="headerlink" href="#keys-on-multiple-machines" title="Permalink to this headline">¶</a></h2>
<p>please be aware that you may work with keys from multiple machines. firts you typically have the id_rsa key on your laptop, that is the key that you should upload with the openstack command to the cloud under the name &lt;portalname&gt;-key this name you will use when booting up machines from your laptop.
However, as this key does not exists on other machines other than your laptop (and if it does you violate any security) You will have to add any other public key to the authorized_keys file in your .ssh directory</p>
<p>The way to do this is to login for example in all your vms with a script from your laptop, invoke the ssh-keygen there and copy all the keys to your local machine while concatenating them with cat &gt;&gt; to a file ~/authorized_keys. Than you copy that file with all the keys (dont forget to add the authorized keys file from your laptop) to all machines. into ~/.ssh/authorized_keys</p>
<p>Now its time to test if this works, use ssh-add to add your local key to the keychain, than you do not have to always type in a password going to a vm. Remember that the ssh-keygen on the vms will not use a password. This will than allow that you can login from each vm to each vm.</p>
<p>SIMPLE enough, and i recommend writing a shellor even better a python script for that</p>
</div>
<div class="section" id="tunnel">
<h2>3.8. tunnel<a class="headerlink" href="#tunnel" title="Permalink to this headline">¶</a></h2>
<p>at times you will be out of floating ips and you can assign one vm form your pool a floating ip or as badi has set up a “proxy” vm.</p>
<p>You can than add to the .ssh/config file the ssh tunnel specification to any of the machines. a script to do this is helpful.</p>
<p>For example</p>
<dl class="docutils">
<dt>Host vm1</dt>
<dd>User  gvonlasz
Hostname &lt;ipof my proxy machine
ProxyCommand  ssh &lt;ipofthemachineirealyneedtogetto&gt; nc %h %p</dd>
</dl>
<p>so this way if i say</p>
<p>ssh vm1 uname -a</p>
<blockquote>
<div><p>I do a tunnel hrough the proxy machine and execute on the vm1</p>
<p>laptop -&gt; proxy -&gt; vm1</p>
</div></blockquote>
<p>Seems simple enough</p>
<p>(hopefully i did not mistype here ;-) )</p>
<p>As you can see at no time I leave the laptop all controlled programmatically</p>
</div>
<div class="section" id="connecting-between-vms">
<h2>3.9. connecting between vms<a class="headerlink" href="#connecting-between-vms" title="Permalink to this headline">¶</a></h2>
<p>assume you have done the key distribution, than it is possible to simply</p>
<p>execute an ssh command to reach another vm as you are authorized to access it via your password less keys. For each vm you have your own key. As in the previous step for distribution you have only copied public keys this will all be secure.</p>
</div>
<div class="section" id="conclusion">
<h2>3.10. Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>This sets up a really elementary security infrastructure so you can login from laptop to any of your vms and from any vm to each other.</p>
</div>
<div class="section" id="but-my-vm-is-active-i-can-not-login">
<h2>3.11. But my vm is active, I can not login<a class="headerlink" href="#but-my-vm-is-active-i-can-not-login" title="Permalink to this headline">¶</a></h2>
<p>Just because your vm is active does not mean you can login. remember a machine gets active whne it starts booting. the boot process can take multiple minutes</p>
</div>
<div class="section" id="denial-of-service-attack-to-your-own-machine">
<h2>3.12. Denial of service attack to your own machine<a class="headerlink" href="#denial-of-service-attack-to-your-own-machine" title="Permalink to this headline">¶</a></h2>
<p>In the past I saw students looping through an ssh command and as soon as it failed issued a new one during boot. They did it so many times that they flodded the network as they did it not just with one but many many more vms. Multiply this by x users and you can see that alone through this process you can create a denial of service attack on cloud services. So what you have to do is to put a sleep between such ssh attemts to see if your vm is really up. Put at least 30 seconds. at time it can be as much as 10 minutes dependent on usage.</p>
</div>
<div class="section" id="focussing-to-get-a-vm-to-run-thats-obviously-dead">
<h2>3.13. Focussing to get a vm to run thats obviously dead<a class="headerlink" href="#focussing-to-get-a-vm-to-run-thats-obviously-dead" title="Permalink to this headline">¶</a></h2>
<p>sometimes I see effort being spend on reviving a vm as the argument is i spend so much time setting it up.</p>
<p>not so, if you spend so much time it should all be done in scripts and thus repeatable. Thus if something is wrong you often are better of just replicating the setup on a new vm and delete toe old one(s).</p>
<p>THIS IS A ROUGH DRAFT THAT I INTEND TO IMPROVE</p>
<p>Also we will have this setup in the next class available as command</p>
<p>e.g.</p>
<p>cm cluster -n 3</p>
<p>will do all of the above automatically</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../management/index.html" class="btn btn-neutral float-right" title="6. Management" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="make.html" class="btn btn-neutral" title="2. Make" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Gregor von Laszewski.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>